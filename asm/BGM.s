.include "macro.inc"

# assembler directives
.set noat      # allow manual use of $at
.set noreorder # don't insert nops after branches
.set gp=64     # allow use of 64-bit general purpose registers

.section .text, "ax"

glabel initBGM
/* 271F0 800265F0 3C048009 */  lui        $a0, %hi(gCurrBGM)
/* 271F4 800265F4 2484FCC1 */  addiu      $a0, $a0, %lo(gCurrBGM)
/* 271F8 800265F8 3C018009 */  lui        $at, %hi(BGMPlayFlag)
/* 271FC 800265FC A420FCC2 */  sh         $zero, %lo(BGMPlayFlag)($at)
/* 27200 80026600 3C018009 */  lui        $at, %hi(BGMStartDelay)
/* 27204 80026604 A420FCC4 */  sh         $zero, %lo(BGMStartDelay)($at)
/* 27208 80026608 240EFFFF */  addiu      $t6, $zero, -1
/* 2720C 8002660C A08E0000 */  sb         $t6, ($a0)
/* 27210 80026610 808F0000 */  lb         $t7, ($a0)
/* 27214 80026614 3C018009 */  lui        $at, %hi(tempCurrBGM)
/* 27218 80026618 241800FF */  addiu      $t8, $zero, 0xff
/* 2721C 8002661C A02FFCC0 */  sb         $t7, %lo(tempCurrBGM)($at)
/* 27220 80026620 3C018009 */  lui        $at, %hi(D_8008FCC6)
/* 27224 80026624 3C038009 */  lui        $v1, %hi(D_8008FCC8)
/* 27228 80026628 A038FCC6 */  sb         $t8, %lo(D_8008FCC6)($at)
/* 2722C 8002662C 24020010 */  addiu      $v0, $zero, 0x10
/* 27230 80026630 2463FCC8 */  addiu      $v1, $v1, %lo(D_8008FCC8)
.L80026634:
/* 27234 80026634 2442FFFC */  addiu      $v0, $v0, -4
/* 27238 80026638 A0600000 */  sb         $zero, ($v1)
/* 2723C 8002663C A0600003 */  sb         $zero, 3($v1)
/* 27240 80026640 A0600006 */  sb         $zero, 6($v1)
/* 27244 80026644 A0600009 */  sb         $zero, 9($v1)
/* 27248 80026648 1440FFFA */  bnez       $v0, .L80026634
/* 2724C 8002664C 2463000C */   addiu     $v1, $v1, 0xc
/* 27250 80026650 03E00008 */  jr         $ra
/* 27254 80026654 00000000 */   nop

glabel startBGM
/* 27258 80026658 27BDFFE0 */  addiu      $sp, $sp, -0x20
/* 2725C 8002665C AFB00014 */  sw         $s0, 0x14($sp)
/* 27260 80026660 3C108009 */  lui        $s0, %hi(BGMPlayFlag)
/* 27264 80026664 2610FCC2 */  addiu      $s0, $s0, %lo(BGMPlayFlag)
/* 27268 80026668 AFBF001C */  sw         $ra, 0x1c($sp)
/* 2726C 8002666C AFB10018 */  sw         $s1, 0x18($sp)
/* 27270 80026670 96020000 */  lhu        $v0, ($s0)
/* 27274 80026674 3C048009 */  lui        $a0, %hi(BGMStartDelay)
/* 27278 80026678 2484FCC4 */  addiu      $a0, $a0, %lo(BGMStartDelay)
/* 2727C 8002667C 304E0001 */  andi       $t6, $v0, 1
/* 27280 80026680 11C00015 */  beqz       $t6, .L800266D8
/* 27284 80026684 00000000 */   nop
/* 27288 80026688 94830000 */  lhu        $v1, ($a0)
/* 2728C 8002668C 3C118009 */  lui        $s1, %hi(tempCurrBGM)
/* 27290 80026690 2631FCC0 */  addiu      $s1, $s1, %lo(tempCurrBGM)
/* 27294 80026694 5460000F */  bnel       $v1, $zero, .L800266D4
/* 27298 80026698 246AFFFF */   addiu     $t2, $v1, -1
/* 2729C 8002669C 822F0000 */  lb         $t7, ($s1)
/* 272A0 800266A0 2401FFFF */  addiu      $at, $zero, -1
/* 272A4 800266A4 34580002 */  ori        $t8, $v0, 2
/* 272A8 800266A8 11E10003 */  beq        $t7, $at, .L800266B8
/* 272AC 800266AC 34590004 */   ori       $t9, $v0, 4
/* 272B0 800266B0 10000002 */  b          .L800266BC
/* 272B4 800266B4 A6180000 */   sh        $t8, ($s0)
.L800266B8:
/* 272B8 800266B8 A6190000 */  sh         $t9, ($s0)
.L800266BC:
/* 272BC 800266BC 96080000 */  lhu        $t0, ($s0)
/* 272C0 800266C0 3109FFFE */  andi       $t1, $t0, 0xfffe
/* 272C4 800266C4 A6090000 */  sh         $t1, ($s0)
/* 272C8 800266C8 10000003 */  b          .L800266D8
/* 272CC 800266CC 3122FFFF */   andi      $v0, $t1, 0xffff
/* 272D0 800266D0 246AFFFF */  addiu      $t2, $v1, -1
.L800266D4:
/* 272D4 800266D4 A48A0000 */  sh         $t2, ($a0)
.L800266D8:
/* 272D8 800266D8 3C118009 */  lui        $s1, %hi(tempCurrBGM)
/* 272DC 800266DC 304B0002 */  andi       $t3, $v0, 2
/* 272E0 800266E0 11600009 */  beqz       $t3, .L80026708
/* 272E4 800266E4 2631FCC0 */   addiu     $s1, $s1, %lo(tempCurrBGM)
/* 272E8 800266E8 304DFFFD */  andi       $t5, $v0, 0xfffd
/* 272EC 800266EC A60D0000 */  sh         $t5, ($s0)
/* 272F0 800266F0 35AE0004 */  ori        $t6, $t5, 4
/* 272F4 800266F4 A60E0000 */  sh         $t6, ($s0)
/* 272F8 800266F8 0C0094FC */  jal        func_800253F0
/* 272FC 800266FC 00002025 */   or        $a0, $zero, $zero
/* 27300 80026700 10000018 */  b          .L80026764
/* 27304 80026704 00000000 */   nop
.L80026708:
/* 27308 80026708 304F0004 */  andi       $t7, $v0, 4
/* 2730C 8002670C 11E00015 */  beqz       $t7, .L80026764
/* 27310 80026710 00000000 */   nop
/* 27314 80026714 0C00950F */  jal        func_8002543C
/* 27318 80026718 00002025 */   or        $a0, $zero, $zero
/* 2731C 8002671C 14400011 */  bnez       $v0, .L80026764
/* 27320 80026720 00000000 */   nop
/* 27324 80026724 96180000 */  lhu        $t8, ($s0)
/* 27328 80026728 3C088009 */  lui        $t0, %hi(gCurrBGM)
/* 2732C 8002672C 2401FFFF */  addiu      $at, $zero, -1
/* 27330 80026730 3319FFFB */  andi       $t9, $t8, 0xfffb
/* 27334 80026734 A6190000 */  sh         $t9, ($s0)
/* 27338 80026738 8108FCC1 */  lb         $t0, %lo(gCurrBGM)($t0)
/* 2733C 8002673C A2280000 */  sb         $t0, ($s1)
/* 27340 80026740 82250000 */  lb         $a1, ($s1)
/* 27344 80026744 10A10007 */  beq        $a1, $at, .L80026764
/* 27348 80026748 00000000 */   nop
/* 2734C 8002674C 0C0094B6 */  jal        func_800252D8
/* 27350 80026750 00002025 */   or        $a0, $zero, $zero
/* 27354 80026754 0C009A81 */  jal        setBGMVolume
/* 27358 80026758 00000000 */   nop
/* 2735C 8002675C 0C0094D9 */  jal        func_80025364
/* 27360 80026760 00002025 */   or        $a0, $zero, $zero
.L80026764:
/* 27364 80026764 3C108009 */  lui        $s0, %hi(D_8008FCC8)
/* 27368 80026768 24110010 */  addiu      $s1, $zero, 0x10
/* 2736C 8002676C 2610FCC8 */  addiu      $s0, $s0, %lo(D_8008FCC8)
.L80026770:
/* 27370 80026770 92020000 */  lbu        $v0, ($s0)
/* 27374 80026774 10400008 */  beqz       $v0, .L80026798
/* 27378 80026778 2449FFFF */   addiu     $t1, $v0, -1
/* 2737C 8002677C 312A00FF */  andi       $t2, $t1, 0xff
/* 27380 80026780 15400005 */  bnez       $t2, .L80026798
/* 27384 80026784 A2090000 */   sb        $t1, ($s0)
/* 27388 80026788 82040001 */  lb         $a0, 1($s0)
/* 2738C 8002678C 92050002 */  lbu        $a1, 2($s0)
/* 27390 80026790 0C0096E3 */  jal        func_80025B8C
/* 27394 80026794 24060040 */   addiu     $a2, $zero, 0x40
.L80026798:
/* 27398 80026798 2631FFFF */  addiu      $s1, $s1, -1
/* 2739C 8002679C 1620FFF4 */  bnez       $s1, .L80026770
/* 273A0 800267A0 26100003 */   addiu     $s0, $s0, 3
/* 273A4 800267A4 8FBF001C */  lw         $ra, 0x1c($sp)
/* 273A8 800267A8 8FB00014 */  lw         $s0, 0x14($sp)
/* 273AC 800267AC 8FB10018 */  lw         $s1, 0x18($sp)
/* 273B0 800267B0 03E00008 */  jr         $ra
/* 273B4 800267B4 27BD0020 */   addiu     $sp, $sp, 0x20

glabel updateBGM
/* 273B8 800267B8 AFA40000 */  sw         $a0, ($sp)
/* 273BC 800267BC 00047600 */  sll        $t6, $a0, 0x18
/* 273C0 800267C0 3C028009 */  lui        $v0, %hi(gCurrBGM)
/* 273C4 800267C4 2442FCC1 */  addiu      $v0, $v0, %lo(gCurrBGM)
/* 273C8 800267C8 000E2603 */  sra        $a0, $t6, 0x18
/* 273CC 800267CC 80580000 */  lb         $t8, ($v0)
/* 273D0 800267D0 3C038009 */  lui        $v1, %hi(BGMPlayFlag)
/* 273D4 800267D4 2463FCC2 */  addiu      $v1, $v1, %lo(BGMPlayFlag)
/* 273D8 800267D8 10980005 */  beq        $a0, $t8, .L800267F0
/* 273DC 800267DC 00000000 */   nop
/* 273E0 800267E0 94790000 */  lhu        $t9, ($v1)
/* 273E4 800267E4 A0440000 */  sb         $a0, ($v0)
/* 273E8 800267E8 37280001 */  ori        $t0, $t9, 1
/* 273EC 800267EC A4680000 */  sh         $t0, ($v1)
.L800267F0:
/* 273F0 800267F0 03E00008 */  jr         $ra
/* 273F4 800267F4 00000000 */   nop

glabel PlayVictoryTheme
/* 273F8 800267F8 AFA40000 */  sw         $a0, ($sp)
/* 273FC 800267FC 00047600 */  sll        $t6, $a0, 0x18
/* 27400 80026800 AFA50004 */  sw         $a1, 4($sp)
/* 27404 80026804 30B8FFFF */  andi       $t8, $a1, 0xffff
/* 27408 80026808 3C028009 */  lui        $v0, %hi(gCurrBGM)
/* 2740C 8002680C 2442FCC1 */  addiu      $v0, $v0, %lo(gCurrBGM)
/* 27410 80026810 03002825 */  or         $a1, $t8, $zero
/* 27414 80026814 000E2603 */  sra        $a0, $t6, 0x18
/* 27418 80026818 80590000 */  lb         $t9, ($v0)
/* 2741C 8002681C 3C038009 */  lui        $v1, %hi(BGMPlayFlag)
/* 27420 80026820 2463FCC2 */  addiu      $v1, $v1, %lo(BGMPlayFlag)
/* 27424 80026824 10990007 */  beq        $a0, $t9, .L80026844
/* 27428 80026828 00000000 */   nop
/* 2742C 8002682C 94680000 */  lhu        $t0, ($v1)
/* 27430 80026830 A0440000 */  sb         $a0, ($v0)
/* 27434 80026834 3C018009 */  lui        $at, %hi(BGMStartDelay)
/* 27438 80026838 35090001 */  ori        $t1, $t0, 1
/* 2743C 8002683C A4690000 */  sh         $t1, ($v1)
/* 27440 80026840 A425FCC4 */  sh         $a1, %lo(BGMStartDelay)($at)
.L80026844:
/* 27444 80026844 03E00008 */  jr         $ra
/* 27448 80026848 00000000 */   nop

glabel updateBGM_mapTransition
/* 2744C 8002684C AFA60008 */  sw         $a2, 8($sp)
/* 27450 80026850 30C7FFFF */  andi       $a3, $a2, 0xffff
/* 27454 80026854 3C028005 */  lui        $v0, %hi(TBL_MapBGMs)
/* 27458 80026858 24423B00 */  addiu      $v0, $v0, %lo(TBL_MapBGMs)
/* 2745C 8002685C 24030046 */  addiu      $v1, $zero, 0x46
/* 27460 80026860 2408FFFF */  addiu      $t0, $zero, -1
.L80026864:
/* 27464 80026864 844E0000 */  lh         $t6, ($v0)
/* 27468 80026868 548E0007 */  bnel       $a0, $t6, .L80026888
/* 2746C 8002686C 2463FFFF */   addiu     $v1, $v1, -1
/* 27470 80026870 84460002 */  lh         $a2, 2($v0)
/* 27474 80026874 10A60006 */  beq        $a1, $a2, .L80026890
/* 27478 80026878 00000000 */   nop
/* 2747C 8002687C 11060004 */  beq        $t0, $a2, .L80026890
/* 27480 80026880 00000000 */   nop
/* 27484 80026884 2463FFFF */  addiu      $v1, $v1, -1
.L80026888:
/* 27488 80026888 1460FFF6 */  bnez       $v1, .L80026864
/* 2748C 8002688C 24420006 */   addiu     $v0, $v0, 6
.L80026890:
/* 27490 80026890 1060000E */  beqz       $v1, .L800268CC
/* 27494 80026894 3C048009 */   lui       $a0, %hi(gCurrBGM)
/* 27498 80026898 2484FCC1 */  addiu      $a0, $a0, %lo(gCurrBGM)
/* 2749C 8002689C 808F0000 */  lb         $t7, ($a0)
/* 274A0 800268A0 80430004 */  lb         $v1, 4($v0)
/* 274A4 800268A4 3C028009 */  lui        $v0, %hi(BGMPlayFlag)
/* 274A8 800268A8 2442FCC2 */  addiu      $v0, $v0, %lo(BGMPlayFlag)
/* 274AC 800268AC 106F0007 */  beq        $v1, $t7, .L800268CC
/* 274B0 800268B0 00000000 */   nop
/* 274B4 800268B4 94580000 */  lhu        $t8, ($v0)
/* 274B8 800268B8 A0830000 */  sb         $v1, ($a0)
/* 274BC 800268BC 3C018009 */  lui        $at, %hi(BGMStartDelay)
/* 274C0 800268C0 37190001 */  ori        $t9, $t8, 1
/* 274C4 800268C4 A4590000 */  sh         $t9, ($v0)
/* 274C8 800268C8 A427FCC4 */  sh         $a3, %lo(BGMStartDelay)($at)
.L800268CC:
/* 274CC 800268CC 03E00008 */  jr         $ra
/* 274D0 800268D0 00000000 */   nop

glabel func_800268D4
/* 274D4 800268D4 27BDFFE8 */  addiu      $sp, $sp, -0x18
/* 274D8 800268D8 AFA40018 */  sw         $a0, 0x18($sp)
/* 274DC 800268DC AFA60020 */  sw         $a2, 0x20($sp)
/* 274E0 800268E0 308E00FF */  andi       $t6, $a0, 0xff
/* 274E4 800268E4 30CF00FF */  andi       $t7, $a2, 0xff
/* 274E8 800268E8 01E03025 */  or         $a2, $t7, $zero
/* 274EC 800268EC 01C02025 */  or         $a0, $t6, $zero
/* 274F0 800268F0 AFBF0014 */  sw         $ra, 0x14($sp)
/* 274F4 800268F4 AFA5001C */  sw         $a1, 0x1c($sp)
/* 274F8 800268F8 83B8001F */  lb         $t8, 0x1f($sp)
/* 274FC 800268FC 3C198005 */  lui        $t9, %hi(D_80053CAC)
/* 27500 80026900 3C098009 */  lui        $t1, %hi(D_8008FCC6)
/* 27504 80026904 0338C821 */  addu       $t9, $t9, $t8
/* 27508 80026908 93393CAC */  lbu        $t9, %lo(D_80053CAC)($t9)
/* 2750C 8002690C 9129FCC6 */  lbu        $t1, %lo(D_8008FCC6)($t1)
/* 27510 80026910 3C0B8009 */  lui        $t3, 0x8009
/* 27514 80026914 03260019 */  multu      $t9, $a2
/* 27518 80026918 24060040 */  addiu      $a2, $zero, 0x40
/* 2751C 8002691C 00004012 */  mflo       $t0
/* 27520 80026920 00000000 */  nop
/* 27524 80026924 00000000 */  nop
/* 27528 80026928 01090019 */  multu      $t0, $t1
/* 2752C 8002692C 00003812 */  mflo       $a3
/* 27530 80026930 00075402 */  srl        $t2, $a3, 0x10
/* 27534 80026934 14800006 */  bnez       $a0, .L80026950
/* 27538 80026938 01403825 */   or        $a3, $t2, $zero
/* 2753C 8002693C 03002025 */  or         $a0, $t8, $zero
/* 27540 80026940 0C0096E3 */  jal        func_80025B8C
/* 27544 80026944 01402825 */   or        $a1, $t2, $zero
/* 27548 80026948 10000011 */  b          .L80026990
/* 2754C 8002694C 8FBF0014 */   lw        $ra, 0x14($sp)
.L80026950:
/* 27550 80026950 916BFCC8 */  lbu        $t3, -0x338($t3)
/* 27554 80026954 3C038009 */  lui        $v1, %hi(D_8008FCC8)
/* 27558 80026958 2402000F */  addiu      $v0, $zero, 0xf
/* 2755C 8002695C 11600007 */  beqz       $t3, .L8002697C
/* 27560 80026960 2463FCC8 */   addiu     $v1, $v1, %lo(D_8008FCC8)
/* 27564 80026964 2442FFFF */  addiu      $v0, $v0, -1
.L80026968:
/* 27568 80026968 10400004 */  beqz       $v0, .L8002697C
/* 2756C 8002696C 24630003 */   addiu     $v1, $v1, 3
/* 27570 80026970 906C0000 */  lbu        $t4, ($v1)
/* 27574 80026974 5580FFFC */  bnel       $t4, $zero, .L80026968
/* 27578 80026978 2442FFFF */   addiu     $v0, $v0, -1
.L8002697C:
/* 2757C 8002697C A0640000 */  sb         $a0, ($v1)
/* 27580 80026980 83AD001F */  lb         $t5, 0x1f($sp)
/* 27584 80026984 A0670002 */  sb         $a3, 2($v1)
/* 27588 80026988 A06D0001 */  sb         $t5, 1($v1)
/* 2758C 8002698C 8FBF0014 */  lw         $ra, 0x14($sp)
.L80026990:
/* 27590 80026990 27BD0018 */  addiu      $sp, $sp, 0x18
/* 27594 80026994 03E00008 */  jr         $ra
/* 27598 80026998 00000000 */   nop

glabel func_8002699C
/* 2759C 8002699C 27BDFFE8 */  addiu      $sp, $sp, -0x18
/* 275A0 800269A0 AFA40018 */  sw         $a0, 0x18($sp)
/* 275A4 800269A4 00047600 */  sll        $t6, $a0, 0x18
/* 275A8 800269A8 000E2603 */  sra        $a0, $t6, 0x18
/* 275AC 800269AC AFBF0014 */  sw         $ra, 0x14($sp)
/* 275B0 800269B0 AFA5001C */  sw         $a1, 0x1c($sp)
/* 275B4 800269B4 30A700FF */  andi       $a3, $a1, 0xff
/* 275B8 800269B8 3C188005 */  lui        $t8, %hi(D_80053CAC)
/* 275BC 800269BC 0304C021 */  addu       $t8, $t8, $a0
/* 275C0 800269C0 93183CAC */  lbu        $t8, %lo(D_80053CAC)($t8)
/* 275C4 800269C4 3C088009 */  lui        $t0, %hi(D_8008FCC6)
/* 275C8 800269C8 9108FCC6 */  lbu        $t0, %lo(D_8008FCC6)($t0)
/* 275CC 800269CC 03070019 */  multu      $t8, $a3
/* 275D0 800269D0 24060040 */  addiu      $a2, $zero, 0x40
/* 275D4 800269D4 0000C812 */  mflo       $t9
/* 275D8 800269D8 00000000 */  nop
/* 275DC 800269DC 00000000 */  nop
/* 275E0 800269E0 03280019 */  multu      $t9, $t0
/* 275E4 800269E4 00002812 */  mflo       $a1
/* 275E8 800269E8 00054C02 */  srl        $t1, $a1, 0x10
/* 275EC 800269EC 0C0096E3 */  jal        func_80025B8C
/* 275F0 800269F0 01202825 */   or        $a1, $t1, $zero
/* 275F4 800269F4 8FBF0014 */  lw         $ra, 0x14($sp)
/* 275F8 800269F8 27BD0018 */  addiu      $sp, $sp, 0x18
/* 275FC 800269FC 03E00008 */  jr         $ra
/* 27600 80026A00 00000000 */   nop

glabel setBGMVolume
/* 27604 80026A04 27BDFFE8 */  addiu      $sp, $sp, -0x18
/* 27608 80026A08 AFBF0014 */  sw         $ra, 0x14($sp)
/* 2760C 80026A0C 3C0E8006 */  lui        $t6, %hi(BGMSliderPos)
/* 27610 80026A10 81CEF010 */  lb         $t6, %lo(BGMSliderPos)($t6)
/* 27614 80026A14 3C048005 */  lui        $a0, %hi(BGMVolLevels)
/* 27618 80026A18 008E2021 */  addu       $a0, $a0, $t6
/* 2761C 80026A1C 0C009955 */  jal        set_alSeqp_vols
/* 27620 80026A20 90843CA4 */   lbu       $a0, %lo(BGMVolLevels)($a0)
/* 27624 80026A24 8FBF0014 */  lw         $ra, 0x14($sp)
/* 27628 80026A28 27BD0018 */  addiu      $sp, $sp, 0x18
/* 2762C 80026A2C 03E00008 */  jr         $ra
/* 27630 80026A30 00000000 */   nop
/* 27634 80026A34 00000000 */  nop
/* 27638 80026A38 00000000 */  nop
/* 2763C 80026A3C 00000000 */  nop
